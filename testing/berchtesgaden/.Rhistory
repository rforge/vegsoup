#	function to paste common abbreviation 4 4 4 letters#
source("/Users/roli/Documents/berchtesgaden/R/fun_make_names.R")#
#
#	Domin scale#
lims <- 0:10#
codes <- c(0.01, 0.1, 1, 5, 10, 25, 33, 50, 75, 90)#
#
#
#	base taxonomy table National Park Berchtesgaden#
taxonomy <- read.csv2("/Users/roli/Documents/berchtesgaden/dta/relevees/taxonomy base.csv", stringsAsFactors = FALSE)[,-1]#
#
species <- read.csv2("/Users/roli/Documents/berchtesgaden/dta/relevees/species key.csv", stringsAsFactors = FALSE)#
#
tmp <- as.numeric(as.character(cut(as.vector(species$cov, mode = "numeric"),#
		breaks = lims, labels = codes, right = TRUE, include.lowest = TRUE)))#
#
#	transfrom to Domin 2.6 scale and cast to matrix#
species$cov <- as.vector(species$cov, mode = "numeric")^(2.6)/4#
#
x <- species#
#
tb <- table(x[,c(1,2,4,3)]) # bring order of vegbaseSpecies#
sc <- dimnames(tb)$cov#
#
for(i in sc)#
{#
	tmp <- tb[,,,i]#
	if (!is.character(tmp))#
		mode(tmp) <- "character"#
	tmp[tmp == "1"]  <- i#
	tb[,,,i]  <- tmp#
}#
#
tmp <- tb[,,,1]#
#
for(i in sc[-1])#
{#
	tmp.i <- tb[,,,i]#
	tmp[tmp.i == i] <- tmp.i[tmp.i == i]#
}#
mode(tmp) <- "numeric"#
#
raw <- tmp #should fit class vegabseSpecies#
#
#	#
tmp <- taxonomy#
#
abbr <- make.abbr(tmp$taxon)#
tmp[tmp$abbr == "",3] <- abbr[tmp$abbr == ""]#
#
tmp <- tmp[tmp$sel == 1,c(1,3)]#
#
length(unique(tmp[,2])) == dim(tmp)[1]#
#
tmp <- tmp[order(tmp$abbr),]#
#
tmp$key <- format(tmp$key, width = 4)#
tmp$key <- gsub(" ", "0", tmp$key)#
#
tmp <- apply(tmp, 1, function (x) paste(x[1], x[2], sep = " "))#
#
con <- file("/Users/roli/Documents/berchtesgaden/dta/relevees/tmp abbr.txt")#
	writeLines(tmp, con)#
close(con)#
#
tmp <- taxonomy
#	function to paste common abbreviation 4 4 4 letters#
source("/Users/roli/Documents/berchtesgaden/R/fun_make_names.R")#
#
#	Domin scale#
lims <- 0:10#
codes <- c(0.01, 0.1, 1, 5, 10, 25, 33, 50, 75, 90)#
#
#
#	base taxonomy table National Park Berchtesgaden#
taxonomy <- read.csv2("/Users/roli/Documents/berchtesgaden/dta/relevees/taxonomy base.csv", stringsAsFactors = FALSE)[,-1]#
#
species <- read.csv2("/Users/roli/Documents/berchtesgaden/dta/relevees/species key.csv", stringsAsFactors = FALSE)#
#
tmp <- as.numeric(as.character(cut(as.vector(species$cov, mode = "numeric"),#
		breaks = lims, labels = codes, right = TRUE, include.lowest = TRUE)))#
#
#	transfrom to Domin 2.6 scale and cast to matrix#
species$cov <- as.vector(species$cov, mode = "numeric")^(2.6)/4#
#
x <- species#
#
tb <- table(x[,c(1,2,4,3)]) # bring order of vegbaseSpecies#
sc <- dimnames(tb)$cov#
#
for(i in sc)#
{#
	tmp <- tb[,,,i]#
	if (!is.character(tmp))#
		mode(tmp) <- "character"#
	tmp[tmp == "1"]  <- i#
	tb[,,,i]  <- tmp#
}#
#
tmp <- tb[,,,1]#
#
for(i in sc[-1])#
{#
	tmp.i <- tb[,,,i]#
	tmp[tmp.i == i] <- tmp.i[tmp.i == i]#
}#
mode(tmp) <- "numeric"#
#
raw <- tmp #should fit class vegabseSpecies#
#
#	#
tmp <- taxonomy#
#
abbr <- make.abbr(tmp$taxon)#
tmp[tmp$abbr == "",3] <- abbr[tmp$abbr == ""]#
#
tmp <- tmp[tmp$sel == 1,c(1,3)]#
#
length(unique(tmp[,2])) == dim(tmp)[1]#
#
tmp <- tmp[order(tmp$abbr),]#
#
tmp$key <- format(tmp$key, width = 4)#
tmp$key <- gsub(" ", "0", tmp$key)#
#
tmp <- apply(tmp, 1, function (x) paste(x[1], x[2], sep = " "))#
#
con <- file("/Users/roli/Documents/berchtesgaden/dta/relevees/taxonomy abbr.txt")#
	writeLines(tmp, con)#
close(con)#
#
tmp <- taxonomy
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/raw/taxonomy.csv")
head(txa)
x <- apply(txa$taxon, make.abbr)
make.abbr <- function (x) #
{#
	# x = tb$taxon#
    names <- make.names(x, unique = FALSE)#
    names <- lapply(strsplit(names, "\\."),#
    function(x) if (length(x) > 1)#
        substring(x, 1, 4)#
    else x)#
    names <- unlist(lapply(names,#
    	function (x) if (length(x) > 1) #
        paste(x[seq(1, length(x))], collapse = " ")#
    else x))#
    names <- gsub("ssp  ", "", names, fixed = TRUE)#
    names <- gsub("var  ", "", names, fixed = TRUE)#
    names <- gsub("  ", " ", names, fixed = TRUE)#
    names#
}
x <- apply(txa$taxon, make.abbr)
make.abbr
x <- sapply(txa$taxon, make.abbr)
x
source("/Users/roli/Documents/gavdos/dta/FunMakeNames.R")
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/raw/taxonomy.csv")#
#
x <- sapply(txa$taxon, make.abbr)
x
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/raw/taxonomy.csv")
txa$taxon
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/raw/taxonomy.csv")#
#
x <- sapply(txa$taxon, make.abbr)
x
source("/Users/roli/Documents/gavdos/dta/FunMakeNames.R")
source("/Users/roli/Documents/gavdos/dta/FunMakeNames.R")
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/raw/taxonomy.csv")#
#
x <- sapply(txa$taxon, make.abbr)
x
source("/Users/roli/Documents/gavdos/dta/FunMakeNames.R")
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/raw/taxonomy.csv")#
#
x <- sapply(txa$taxon, make.abbr)
x
source("/Users/roli/Documents/gavdos/dta/FunMakeNames.R")
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/raw/taxonomy.csv")#
#
x <- sapply(txa$taxon, make.abbr)
x
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/raw/taxonomy.csv")#
#
x <- sapply(txa$taxon, make.abbr)#
#
write.csv2(x, "foo.csv")
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/raw/taxonomy.csv")
head(txa)
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/raw/taxonomy.csv")#
#
tax$abbr <- tolower(txa$abbr)
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/raw/taxonomy.csv")#
#
txa$abbr <- tolower(txa$abbr)
head(txa)
txa[duplicated(txa$abbr),]
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/raw/taxonomy.csv")#
#
txa$abbr <- tolower(txa$abbr)
txa[duplicated(txa$abbr),]
write.csv2(txa, "foo.csv")
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/taxonomy.csv")
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/taxonomy.csv")
head
head(txa)
format(txa$key)
?format
x <- format(txa$key)#
gsub(" ", "0", x)
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/taxonomy.csv")#
#
x <- format(txa$key)#
txa$key <- gsub(" ", "0", x)
head(txa)
write.csv2(txa, "/Users/roli/Documents/gavdos/dta/relevees/taxonomy.csv")
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/taxonomy.csv")
head(txa)
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/taxonomy.csv")
head(txa)
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/taxonomy.csv")#
#
x <- format(txa$key)#
txa$key <- gsub(" ", "0", x)
txa$key
paste(txa$key, txa$abbr)
x <- paste(txa$key, txa$abbr)
con <- file("/Users/roli/Documents/gavdos/indd/taxonomy abbr.txt")#
writeLines(x, con)#
close(con)
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/taxonomy.csv")
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/taxonomy.csv")#
#
x <- format(txa$key)#
txa$key <- gsub(" ", "0", x)
x <- paste(txa$key, txa$abbr, txa$taxon)
x
txa <- read.csv2("/Users/roli/Documents/gavdos/dta/relevees/taxonomy.csv")#
#
x <- format(txa$key)#
txa$key <- gsub(" ", "0", x)#
#
x <- paste(txa$key, txa$abbr, "	", txa$taxon)
x
con <- file("/Users/roli/Documents/gavdos/indd/taxonomy list.txt")#
writeLines(x, con)#
close(con)
